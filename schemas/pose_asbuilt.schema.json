{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://directive-engine.example/schemas/pose_asbuilt.schema.json",
  "title": "Directive Engine - As-Built Poses v0.1",
  "type": "object",
  "additionalProperties": false,
  "required": ["schema_version", "dataset_id", "frame_id", "units", "measured_at", "parts"],
  "properties": {
    "schema_version": { "type": "string", "const": "v0.1" },
    "dataset_id": { "type": "string", "minLength": 1 },
    "frame_id": { "type": "string", "const": "world" },
    "units": {
      "type": "object",
      "additionalProperties": false,
      "required": ["length", "rotation"],
      "properties": {
        "length": { "type": "string", "const": "mm" },
        "rotation": { "type": "string", "const": "quaternion_xyzw" }
      }
    },
    "measured_at": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp of as-built measurement (ISO 8601)."
    },
    "parts": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/AsBuiltPartPose" }
    }
  },
  "$defs": {
    "Vec3mm": {
      "type": "array",
      "minItems": 3,
      "maxItems": 3,
      "items": { "type": "number" }
    },
    "QuatXYWZ": {
      "type": "array",
      "minItems": 4,
      "maxItems": 4,
      "items": { "type": "number", "minimum": -1.0, "maximum": 1.0 }
    },
    "Transform": {
      "type": "object",
      "additionalProperties": false,
      "required": ["translation_mm", "rotation_quat_xyzw"],
      "properties": {
        "translation_mm": { "$ref": "#/$defs/Vec3mm" },
        "rotation_quat_xyzw": { "$ref": "#/$defs/QuatXYWZ" }
      }
    },
    "Confidence": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "description": "0..1 confidence score for pose quality (higher is better)."
    },
    "AsBuiltPartPose": {
      "type": "object",
      "additionalProperties": false,
      "required": ["part_id", "T_world_part_asBuilt", "pose_confidence"],
      "properties": {
        "part_id": { "type": "string", "minLength": 1 },
        "T_world_part_asBuilt": { "$ref": "#/$defs/Transform" },
        "pose_confidence": { "$ref": "#/$defs/Confidence" },
        "confidence_notes": {
          "type": "string",
          "description": "Optional human-readable notes about confidence (e.g., occlusion, partial view)."
        }
      }
    }
  }
}

